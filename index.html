<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yodo Tarot - Rhizomatic Divination</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="card-mapping.js"></script></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Yodo Tarot</h1>
            <p class="subtitle">Rhizomatic Divination & Analysis</p>
        </header>

        <!-- Phase 1: Initial Question -->
        <section id="phase-question" class="phase active">
            <h2>Which aspect of your psyche shall we explore today?</h2>
            <div class="options">
                <button class="option-btn" data-choice="specific">A specific question or situation</button>
                <button class="option-btn" data-choice="general">A general life reading</button>
                <button class="option-btn" data-choice="deep">A deep psychological exploration</button>
            </div>
            <div id="question-input" class="hidden">
                <textarea id="user-question" placeholder="Share your question or describe your situation..."></textarea>
                <button id="submit-question" class="primary-btn">Begin Reading</button>
            </div>
        </section>

        <!-- Phase 2: Tarot Reading -->
        <section id="phase-reading" class="phase hidden">
            <div class="loading hidden" id="reading-loading">
                <div class="spinner"></div>
                <p>Consulting the cards...</p>
                <p class="timer" id="reading-timer">~30 seconds</p>
            </div>
            <div id="reading-content" class="content-box"></div>
            <div id="reading-complete" class="hidden">
                <h3>Ready to Explore?</h3>
                <div class="options">
                    <button id="explore-yes" class="option-btn">Yes</button>
                    <button id="explore-no" class="option-btn">No, continue the reading</button>
                </div>
            </div>
            <div id="followup-section" class="hidden">
                <h3>What else would you like to explore?</h3>
                <textarea id="followup-question" placeholder="Ask a follow-up question, share what's arising, or reflect on what resonates..."></textarea>
                <button id="submit-followup" class="primary-btn">Continue Reading</button>
                <div class="loading hidden" id="followup-loading">
                    <div class="spinner"></div>
                    <p>Consulting the cards...</p>
                    <p class="timer" id="followup-timer">~30 seconds</p>
                </div>
            </div>
        </section>

        <!-- Phase 3: Control or Chaos -->
        <section id="phase-choice" class="phase hidden">
            <h2>Choose your path</h2>
            <div class="options">
                <button id="choice-control" class="option-btn">
                    <span class="choice-title">Control</span>
                    <span class="choice-desc">Use only reading-derived nodes</span>
                </button>
                <button id="choice-chaos" class="option-btn">
                    <span class="choice-title">Chaos</span>
                    <span class="choice-desc">Incorporate expanded symbolic connections</span>
                </button>
            </div>
        </section>

        <!-- Phase 4: Final Confirmation -->
        <section id="phase-confirm" class="phase hidden">
            <h2>All Set, Ready to Yodo Read?</h2>
            <button id="begin-mapping" class="primary-btn">Begin Rhizomatic Analysis</button>
        </section>

        <!-- Phase 5: Rhizomatic Mapping -->
        <section id="phase-mapping" class="phase hidden">
            <div class="loading hidden" id="mapping-loading">
                <div class="spinner"></div>
                <p>Mapping connections...</p>
                <p class="timer" id="mapping-timer">~72 seconds</p>
            </div>
            <div class="reading-summary hidden" id="reading-summary">
                <p><strong>Analyzing your reading:</strong> <span id="summary-text"></span></p>
            </div>
            <div class="mapping-container">
                <div class="cycle-info">
                    <h3>Cycle <span id="current-cycle">1</span> of 4</h3>
                    <p id="cycle-description"></p>
                    <div class="cycle-progress">
                        <div class="cycle-progress-bar" id="cycle-progress-bar" style="width: 25%"></div>
                    </div>
                </div>
                <div id="cycle-buttons" class="cycle-buttons"></div>
                <div id="network-graph"></div>
                <div id="mapping-insights" class="content-box"></div>
            </div>
        </section>

        <!-- Phase 6: Final Synthesis -->
        <section id="phase-synthesis" class="phase hidden">
            <h2>Synthesis & Integration</h2>
            <div id="synthesis-content" class="content-box"></div>
            <div class="actions">
                <button id="export-btn" class="primary-btn">Export Reading</button>
                <button id="new-reading-btn" class="secondary-btn">New Reading</button>
            </div>
        </section>

        <!-- Export Modal -->
        <div id="export-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Export Your Reading</h3>
                <div class="export-options">
                    <button class="export-btn" data-format="txt">Text File (.txt)</button>
                    <button class="export-btn" data-format="json">JSON Data (.json)</button>
                    <button class="export-btn" data-format="html">HTML Document (.html)</button>
                    <button class="export-btn" data-format="pdf">PDF Document (.pdf)</button>
                </div>
                <button id="close-modal" class="secondary-btn">Close</button>
            </div>
        </div>

        <!-- Card Full-Size Modal -->
        <div id="card-modal" class="card-modal">
            <div class="card-modal-close">×</div>
            <img id="card-modal-image" class="card-modal-image" src="" alt="">
        </div>

        <!-- Cycle Viewer Modal -->
        <div id="cycle-modal" class="modal hidden cycle-modal-wrapper" onclick="if(event.target.id === 'cycle-modal') closeCycleModal();">
            <div class="modal-content cycle-modal-content">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <h3 id="cycle-modal-title">Cycle 1</h3>
                    <div class="cycle-modal-close-btn" onclick="closeCycleModal();">×</div>
                </div>
                <div id="cycle-modal-graph" class="cycle-modal-graph"></div>
                <div id="cycle-modal-insights" class="content-box"></div>
                <button id="close-cycle-modal" class="secondary-btn">Close</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
